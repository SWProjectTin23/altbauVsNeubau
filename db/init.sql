CREATE TABLE IF NOT EXISTS sensor_data (
    device_id INT NOT NULL,
    timestamp TIMESTAMPTZ NOT NULL,
    temperature DECIMAL(5, 2),
    humidity DECIMAL(5, 2),
    pollen INT,
    particulate_matter INT,
    PRIMARY KEY (device_id, timestamp)
);

-- change table to hypertable
SELECT create_hypertable('sensor_data', 'timestamp', if_not_exists => TRUE);

CREATE TABLE IF NOT EXISTS thresholds (
    temperature_min_soft DECIMAL(5, 2),
    temperature_max_soft DECIMAL(5, 2),
    temperature_min_hard DECIMAL(5, 2),
    temperature_max_hard DECIMAL(5, 2),
    humidity_min_soft DECIMAL(5, 2),
    humidity_max_soft DECIMAL(5, 2),
    humidity_min_hard DECIMAL(5, 2),
    humidity_max_hard DECIMAL(5, 2),
    pollen_min_soft INT,
    pollen_max_soft INT,
    pollen_min_hard INT,
    pollen_max_hard INT,
    particulate_matter_min_soft INT,
    particulate_matter_max_soft INT,
    particulate_matter_min_hard INT,
    particulate_matter_max_hard INT,
    last_updated TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);

-- Implement test -- Drop an existing database '
INSERT INTO sensor_data (device_id, timestamp, temperature, humidity, pollen, particulate_matter) VALUES
(1, '2025-07-20 00:00:00+00', 22.50, 55.20, 15, 30),
(2, '2025-07-20 00:00:00+00', 23.10, 58.10, 20, 35),
(1, '2025-07-20 00:10:00+00', 22.65, 55.35, 16, 31),
(2, '2025-07-20 00:10:00+00', 23.25, 58.25, 21, 36),
(1, '2025-07-20 00:20:00+00', 22.80, 55.50, 17, 32),
(2, '2025-07-20 00:20:00+00', 23.40, 58.40, 22, 37),
(1, '2025-07-20 00:30:00+00', 22.95, 55.65, 18, 33),
(2, '2025-07-20 00:30:00+00', 23.55, 58.55, 23, 38),
(1, '2025-07-20 00:40:00+00', 23.10, 55.80, 19, 34),
(2, '2025-07-20 00:40:00+00', 23.70, 58.70, 24, 39),
(1, '2025-07-20 00:50:00+00', 23.25, 55.95, 20, 35),
(2, '2025-07-20 00:50:00+00', 23.85, 58.85, 25, 40),
(1, '2025-07-20 01:00:00+00', 23.40, 56.10, 21, 36),
(2, '2025-07-20 01:00:00+00', 24.00, 59.00, 26, 41),
(1, '2025-07-20 01:10:00+00', 23.55, 56.25, 22, 37),
(2, '2025-07-20 01:10:00+00', 24.15, 59.15, 27, 42),
(1, '2025-07-20 01:20:00+00', 23.70, 56.40, 23, 38),
(2, '2025-07-20 01:20:00+00', 24.30, 59.30, 28, 43),
(1, '2025-07-20 01:30:00+00', 23.85, 56.55, 24, 39),
(2, '2025-07-20 01:30:00+00', 24.45, 59.45, 29, 44),
(1, '2025-07-20 01:40:00+00', 24.00, 56.70, 25, 40),
(2, '2025-07-20 01:40:00+00', 24.60, 59.60, 30, 45),
(1, '2025-07-20 01:50:00+00', 24.15, 56.85, 26, 41),
(2, '2025-07-20 01:50:00+00', 24.75, 59.75, 31, 46),
(1, '2025-07-20 02:00:00+00', 24.30, 57.00, 27, 42),
(2, '2025-07-20 02:00:00+00', 24.90, 59.90, 32, 47),
(1, '2025-07-20 02:10:00+00', 24.45, 57.15, 28, 43),
(2, '2025-07-20 02:10:00+00', 25.05, 60.05, 33, 48),
(1, '2025-07-20 02:20:00+00', 24.60, 57.30, 29, 44),
(2, '2025-07-20 02:20:00+00', 25.20, 60.20, 34, 49),
(1, '2025-07-20 02:30:00+00', 24.75, 57.45, 30, 45),
(2, '2025-07-20 02:30:00+00', 25.35, 60.35, 35, 50),
(1, '2025-07-20 02:40:00+00', 24.90, 57.60, 31, 46),
(2, '2025-07-20 02:40:00+00', 25.50, 60.50, 36, 51),
(1, '2025-07-20 02:50:00+00', 25.05, 57.75, 32, 47),
(2, '2025-07-20 02:50:00+00', 25.65, 60.65, 37, 52),
(1, '2025-07-20 03:00:00+00', 25.20, 57.90, 33, 48),
(2, '2025-07-20 03:00:00+00', 25.80, 60.80, 38, 53),
(1, '2025-07-20 03:10:00+00', 25.35, 58.05, 34, 49),
(2, '2025-07-20 03:10:00+00', 25.95, 60.95, 39, 54),
(1, '2025-07-20 03:20:00+00', 25.50, 58.20, 35, 50),
(2, '2025-07-20 03:20:00+00', 26.10, 61.10, 40, 55),
(1, '2025-07-20 03:30:00+00', 25.65, 58.35, 36, 51),
(2, '2025-07-20 03:30:00+00', 26.25, 61.25, 41, 56),
(1, '2025-07-20 03:40:00+00', 25.80, 58.50, 37, 52),
(2, '2025-07-20 03:40:00+00', 26.40, 61.40, 42, 57),
(1, '2025-07-20 03:50:00+00', 25.95, 58.65, 38, 53),
(2, '2025-07-20 03:50:00+00', 26.55, 61.55, 43, 58),
(1, '2025-07-20 04:00:00+00', 26.10, 58.80, 39, 54),
(2, '2025-07-20 04:00:00+00', 26.70, 61.70, 44, 59),
(1, '2025-07-20 04:10:00+00', 26.25, 58.95, 40, 55),
(2, '2025-07-20 04:10:00+00', 26.85, 61.85, 45, 60),
(1, '2025-07-20 04:20:00+00', 26.40, 59.10, 41, 56),
(2, '2025-07-20 04:20:00+00', 27.00, 62.00, 46, 61),
(1, '2025-07-20 04:30:00+00', 26.55, 59.25, 42, 57),
(2, '2025-07-20 04:30:00+00', 27.15, 62.15, 47, 62),
(1, '2025-07-20 04:40:00+00', 26.70, 59.40, 43, 58),
(2, '2025-07-20 04:40:00+00', 27.30, 62.30, 48, 63),
(1, '2025-07-20 04:50:00+00', 26.85, 59.55, 44, 59),
(2, '2025-07-20 04:50:00+00', 27.45, 62.45, 49, 64),
(1, '2025-07-20 05:00:00+00', 27.00, 59.70, 45, 60),
(2, '2025-07-20 05:00:00+00', 27.60, 62.60, 50, 65);

DELETE FROM thresholds;
INSERT INTO thresholds (temperature_min_soft, temperature_max_soft, temperature_min_hard, temperature_max_hard,
                        humidity_min_soft, humidity_max_soft, humidity_min_hard, humidity_max_hard,
                        pollen_min_soft, pollen_max_soft, pollen_min_hard, pollen_max_hard,
                        particulate_matter_min_soft, particulate_matter_max_soft, particulate_matter_min_hard, particulate_matter_max_hard) VALUES
(18.00, 28.00, 20.00, 30.00,
 30.00, 70.00, 40.00, 80.00,
 5, 50, 10, 70,
 10, 60, 20, 80);
